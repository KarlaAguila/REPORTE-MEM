<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Análisis MEM - Precios Zonales, Consumo y Generación</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #006633 0%, #39A935 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: white;
            color: #3A3A38;
            padding: 30px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 30px;
            flex-wrap: wrap;
            border-bottom: 3px solid #006633;
        }
        
        .header-logo {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-shrink: 0;
        }
        
        .header-logo img {
            height: 70px;
            width: auto;
            object-fit: contain;
        }
        
        .header-content {
            text-align: center;
            flex: 1;
        }
        
        .header h1 {
            font-size: 2.6em;
            margin-bottom: 12px;
            color: #006633;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .header p {
            font-size: 1.15em;
            color: #2c3e50;
            font-weight: 400;
        }
        
        .header .note {
            font-size: 0.85em;
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 102, 51, 0.1);
            border-radius: 5px;
            display: inline-block;
            color: #3A3A38;
        }
        
        .nav-tabs {
            display: flex;
            background: #ffffff;
            border-bottom: 3px solid #006633;
            overflow-x: auto;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .nav-tab {
            flex: 1;
            padding: 18px 24px;
            text-align: center;
            cursor: pointer;
            background: #ffffff;
            border: none;
            border-right: 1px solid rgba(0, 102, 51, 0.15);
            font-size: 1.05em;
            font-weight: 600;
            color: #2c3e50;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            letter-spacing: 0.2px;
        }
        
        .nav-tab:hover {
            background: rgba(0, 102, 51, 0.08);
            color: #006633;
        }
        
        .nav-tab.active {
            background: #006633;
            color: white;
            border-bottom: 4px solid #93C01F;
            box-shadow: 0 -2px 8px rgba(0, 102, 51, 0.2);
        }
        
        .section {
            display: none;
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
        }
        
        .section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .section-header {
            margin-bottom: 35px;
            padding-bottom: 20px;
            border-bottom: 3px solid #006633;
        }
        
        .section-header h2 {
            color: #006633;
            font-size: 2.2em;
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .section-header p {
            color: #2c3e50;
            font-size: 1.15em;
            font-weight: 400;
            line-height: 1.7;
        }
        
        .visuals-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 35px;
            margin-top: 30px;
        }
        
        .visual-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(0, 102, 51, 0.1);
        }
        
        .visual-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 24px rgba(0, 102, 51, 0.15);
            border-color: #39A935;
        }
        
        .visual-card h3 {
            color: #006633;
            margin-bottom: 15px;
            font-size: 1.4em;
            font-weight: 700;
            padding-bottom: 12px;
            border-bottom: 3px solid #39A935;
            letter-spacing: -0.3px;
        }
        
        .visual-card .description {
            color: #2c3e50;
            font-size: 0.95em;
            line-height: 1.8;
            margin-bottom: 20px;
            padding: 15px 18px;
            background: linear-gradient(to right, rgba(0, 102, 51, 0.08), rgba(57, 169, 53, 0.05));
            border-left: 4px solid #39A935;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            text-align: justify;
        }
        
        .visual-card .description strong {
            color: #006633;
            font-weight: 700;
            letter-spacing: 0.3px;
        }
        
        .visual-card .description br {
            margin-bottom: 8px;
        }
        
        .visual-container {
            width: 100%;
            height: 700px;
            border: 1px solid rgba(0, 102, 51, 0.15);
            border-radius: 8px;
            overflow: visible;
            background: white;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .visual-container iframe,
        .visual-container object {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
            overflow: visible;
        }
        
        .loading-message {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-weight: 600;
        }
        
        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #3A3A38;
            border-top: 2px solid #39A935;
        }
        
        .no-visual {
            text-align: center;
            padding: 40px;
            color: #3A3A38;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                border-right: none;
                border-bottom: 1px solid #dee2e6;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class='header-logo'><img src='img/beetmann.png' alt='Beetmann Logo' /></div>
            <div class="header-content">
                <h1>Reporte de Análisis MEM</h1>
                <p>Precios Zonales, Consumo y Generación de Energía</p>
                <p style="font-size: 0.9em; margin-top: 10px;">Última actualización: 09/12/2025 13:31:29</p>
            </div>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection(0)">MDA / MTR</button>
            <button class="nav-tab " onclick="showSection(1)">Spreads y Diferencia entre MDA y MTR</button>
            <button class="nav-tab " onclick="showSection(2)">Consumo</button>
        </div>
        <div id="section-0" class="section active">
            <div class="section-header">
                <h2>MDA / MTR</h2>
                <p>Análisis de Precios Zonales MDA y MTR</p>
            </div>
            <div class="visuals-grid">
                <div class="visual-card">
                    <h3>Precio Promedio por Hora</h3>
                    <div class="description">Muestra el precio promedio zonal por hora del día para los mercados MDA y MTR. Permite comparar cómo varían los precios a lo largo de las 24 horas y entre diferentes zonas dentro del rango de fechas seleccionado.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/zonal_price/precio_horario_combined.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Componente Pérdidas por Hora</h3>
                    <div class="description">Gráfico del componente de pérdidas del PMZ que muestra hora por hora el costo asociado a la eficiencia de transmisión, permitiendo identificar rápidamente qué zonas tienen mayor penalización por su ubicación en la red.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/zonal_price/componente_perdidas_combined.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Componente Congestión por Hora</h3>
                    <div class="description">Gráfico del componente de congestión del PMZ que muestra hora por hora el impacto económico de la saturación, permitiendo identificar rápidamente qué zonas presentan cuellos de botella en sus enlaces con la red.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/zonal_price/componente_congestion_combined.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Precio Mensual-Horario - MDA/MTR</h3>
                    <div class="description">Este gráfico muestra el perfil horario promedio de cada mes, permitiendo identificar patrones estacionales y las épocas del año con mayores costos para la zona seleccionada.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/zonal_price/evolucion_historica_combined.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
            </div>
        </div>
        <div id="section-1" class="section ">
            <div class="section-header">
                <h2>Spreads y Diferencia entre MDA y MTR</h2>
                <p>Análisis de Spreads, Diferencias y Distribuciones</p>
            </div>
            <div class="visuals-grid">
                <div class="visual-card">
                    <h3>Spread Diario (MDA/MTR)</h3>
                    <div class="description">Este gráfico representa la diferencia entre el precio máximo y mínimo del día, mostrando la variabilidad en cada zona para identificar rápidamente periodos de alta volatilidad y eventos extremos en el mercado.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/zonal_price/spread_diario_combined.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Distribución KDE del Spread (MDA/MTR)</h3>
                    <div class="description">Este grafico muestra la frecuencia con la que ocurren diferentes niveles de volatilidad (precio máximo - mínimo) en cada zona, permitiendo distinguir entre regiones con precios estables y aquellas propensas a eventos de precios extremos.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/zonal_price/spread_kde_combined.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Boxplot Spread Diario (MDA/MTR)</h3>
                    <div class="description">Este gráfico utiliza diagramas de caja para visualizar la distribución de la volatilidad, permitiendo comparar la dispersión habitual de precios (cajas) e identificar la magnitud y frecuencia de los eventos extremos (valores atípicos) en cada región.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/zonal_price/boxplot_spread_combined.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Matriz Mensual de Spread Diario Promedio</h3>
                    <div class="description">Matriz de calor que muestra la intensidad de la volatilidad mensual por zona, facilitando la detección rápida de los meses con mayor inestabilidad de precios.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/zonal_price/heatmap_spread_mensual_combined.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Matriz de Porcentaje de Días donde MDA > MTR</h3>
                    <div class="description">Matriz que muestra el porcentaje de días en que el precio MDA fue mayor que MTR por zona y mes. Valores altos indican que el mercado programado fue consistentemente más caro que el mercado real, lo cual puede sugerir oportunidades de optimización en la estrategia de compra de energía.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/zonal_price/heatmap_porcentaje_mda_gt_mtr_combined.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Matriz Media Diferencias MDA-MTR</h3>
                    <div class="description">Este gráfico muestra la diferencia promedio mensual de precios (MDA - MTR). Los valores positivos (verde) indican que el MDA fue más costoso en promedio, mientras que los valores negativos (rojo) señalan que el MTR fue más caro.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/zonal_price/heatmap_mean_consumo_combined.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Matriz P95 Diferencias MDA-MTR</h3>
                    <div class="description">Esta matriz de calor representa los escenarios extremos de sobrecosto: los valores altos (verde) indican cuánto llegó a exceder el precio del MDA al del MTR en los momentos de mayor volatilidad.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/zonal_price/heatmap_p95_consumo_combined.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
            </div>
        </div>
        <div id="section-2" class="section ">
            <div class="section-header">
                <h2>Consumo</h2>
                <p>Análisis de Consumo de Energía y Montos en Mercados</p>
            </div>
            <div class="visuals-grid">
                <div class="visual-card">
                    <h3>Matriz de Montos MDA por Zona y Clave de Carga</h3>
                    <div class="description">Visualización que muestra la suma mensual de montos en el Mercado del Día en Adelanto (MDA), calculada como el producto de la Energía Asignada en MDA por el Precio Marginal Local MDA.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/data_consumption/heatmap_montoMDA.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Matriz de Montos MTR por Zona y Clave de Carga</h3>
                    <div class="description">Representación de la suma mensual de montos en el Mercado de Tiempo Real (MTR), calculada como el producto de la Energía Asignada en MTR por el Precio Marginal Local MTR.<br><br><strong>Interpretación de valores:</strong><br>• <strong>Valores positivos:</strong> Representan costos adicionales por consumir más de lo planeado o por recompras a precio real del mercado.<br>• <strong>Valores negativos:</strong> Indican ingresos por consumir menos de lo comprometido inicialmente.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/data_consumption/heatmap_montoMTR.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Matriz de Montos Totales por Zona y Clave de Carga</h3>
                    <div class="description">Visualización que muestra el monto final a pagar por zona y clave de carga. Este valor representa la suma del Monto MDA más el Monto MTR.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/data_consumption/heatmap_montoTOTAL.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Distribución Mensual de Montos por Clave de Carga</h3>
                    <div class="description">Este grafico muestra qué centros de carga contribuyen más al gasto total de energía en cada mes.  <br><br><strong>Método de cálculo:</strong> Para cada celda se divide el Monto Total de la Clave entre el Monto Total de todas las claves en ese mes, multiplicado por 100 para obtener el porcentaje.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/data_consumption/heatmap_distribucionMensual_ClaveCarga.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Proporción de Compra en MDA (% Volumen sobre Total)</h3>
                    <div class="description">  Muestra qué porcentaje de la energía total consumida fue adquirida previamente en el Mercado del Día en Adelanto. <br><br><strong>Fórmula:</strong> (MWh Comprados en MDA / MWh Totales Consumidos) × 100</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/data_consumption/heatmap_proporcionMDA.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Escenarios de Montos en Mercados</h3>
                    <div class="description"><b>Comparativa estratégica del costo real pagado frente a diferentes escenarios hipotéticos de compra de energía.</b><br>Este tablero evalúa la eficiencia de compra contrastando el Costo Real frente a dos escenarios:<br>• <span style='color: #006400'><b>Escenario Óptimo (verde):</b></span> Refleja el ahorro potencial no capturado.<br>• <span style='color: #B22222'><b>Escenario Pésimo (rojo):</b></span> Representa el riesgo de mercado evitado.<br>El <b>índice final</b> califica la gestión del 0% al 100%, indicando qué tan cerca estuvimos de obtener el precio mínimo posible.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/data_consumption/heatmap_Escenarios_MEM.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Promedio de Consumo Diario por Cliente</h3>
                    <div class="description">Este grafico muestra el consumo promedio diario de energía (MWh) por cliente, ordenado de mayor a menor consumo.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/data_consumption/promedio_diario.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Consumo Promedio por Hora</h3>
                    <div class="description">Este grafico muestra cómo varía el consumo de energía a lo largo de las 24 horas del día, permitiendo identificar horas pico.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/data_consumption/promedio_hora.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
                <div class="visual-card">
                    <h3>Consumo Promedio por Hora y Mes</h3>
                    <div class="description">Este grafico muestra cómo cambia el perfil de carga promedio por hora según el mes del año.</div>
                    <div class="visual-container">
                        <iframe 
                            src="visualizations/data_consumption/promedio_hora_mensual.html" 
                            loading="lazy" 
                            frameborder="0"
                            scrolling="no"
                            style="width: 100%; height: 100%; border: none;"
                            onload="this.style.opacity=1"
                            onerror="this.parentElement.innerHTML='<div class=\'loading-message\'>Error al cargar la visualización</div>'"
                        ></iframe>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer">
            
        </div>
    </div>
    
    <script>
        function showSection(index) {
            // Ocultar todas las secciones
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar la sección seleccionada
            const activeSection = document.getElementById(`section-${index}`);
            activeSection.classList.add('active');
            
            // Actualizar tabs activos
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach((tab, i) => {
                if (i === index) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // Forzar resize de gráficos Plotly en los iframes de la sección activa
            // Usar múltiples timeouts para asegurar que el iframe esté completamente visible
            setTimeout(() => {
                const iframes = activeSection.querySelectorAll('iframe');
                iframes.forEach(iframe => {
                    // Enviar mensaje de resize múltiples veces para asegurar que se reciba
                    for (let i = 0; i < 3; i++) {
                        setTimeout(() => {
                            try {
                                iframe.contentWindow.postMessage('resize', '*');
                            } catch (e) {
                                // Error de CORS es normal
                            }
                        }, i * 200);
                    }
                });
            }, 150);
            
            // Scroll suave al inicio
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Observar cuando los iframes se hacen visibles y forzar resize de Plotly
        const resizeObserverOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.01
        };
        
        const resizeObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && entry.intersectionRatio > 0.1) {
                    const iframe = entry.target.querySelector('iframe');
                    if (iframe) {
                        // Esperar a que el iframe cargue completamente y esté visible
                        setTimeout(() => {
                            try {
                                // Enviar mensaje de resize múltiples veces
                                for (let i = 0; i < 2; i++) {
                                    setTimeout(() => {
                                        try {
                                            iframe.contentWindow.postMessage('resize', '*');
                                        } catch (e) {
                                            // Error de CORS es normal
                                        }
                                    }, i * 200);
                                }
                            } catch (e) {
                                // Error de CORS es normal
                            }
                        }, 200);
                    }
                }
            });
        }, resizeObserverOptions);
        
        // Observar todos los contenedores de visuales
        document.addEventListener('DOMContentLoaded', () => {
            const visualContainers = document.querySelectorAll('.visual-container');
            visualContainers.forEach(container => {
                resizeObserver.observe(container);
            });
        });
    </script>
</body>
</html>